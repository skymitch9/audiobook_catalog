<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Audiobook Catalog</title>
<style>
/* =============== Theming =============== */
:root{
  --pad:14px; --radius:14px;
  --bg:#ffffff; --bg-2:#fafafa;
  --text:#1b1f23; --muted:#5f6b7a;
  --border:#e5e7eb;
  --chip:#f2f2f2;
  --btn-bg:#f7f7f7; --btn-bg-active:#e8f0fe; --btn-border:#ddd; --btn-active:#b6c6ff;
  --row-alt:#fcfcfc; --row-hover:#f5f9ff;
  --overlay: rgba(0,0,0,.55);
}
body.dark{
  --bg:#0f141a; --bg-2:#121820;
  --text:#e7eef7; --muted:#9fb0c6;
  --border:#263241;
  --chip:#1f2a37;
  --btn-bg:#1a2330; --btn-bg-active:#16324a; --btn-border:#2b3a4d; --btn-active:#2d72d2;
  --row-alt:#0f1722; --row-hover:#132033;
  --overlay: rgba(0,0,0,.65);
}

/* =============== Base Layout =============== */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; padding:var(--pad);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg); color:var(--text);
}
#wrap{max-width:1100px;margin:0 auto}
h1{margin:0 0 8px 0}

/* Controls */
#controls{display:grid;gap:8px;grid-template-columns:1fr;align-items:center;margin:8px 0 14px}
.controls-row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
input#ab-search, select#ab-sort, select#ab-page-size{
  flex:1 1 auto; padding:10px 12px; border:1px solid var(--border); border-radius:var(--radius);
  background:var(--bg-2); color:var(--text)
}
button.btn{
  padding:10px 12px; border:1px solid var(--btn-border); border-radius:var(--radius);
  background:var(--btn-bg); color:var(--text); cursor:pointer
}
button.btn:focus, select:focus, input:focus{ outline:2px solid #2d72d2; outline-offset:2px }
#meta{color:var(--muted)}

/* Dark mode switch */
.switch{ display:inline-flex; align-items:center; gap:8px; user-select:none }
.switch .label{font-size:.95em; color:var(--muted)}
.switch input{display:none}
.switch .track{
  width:46px; height:26px; border-radius:999px; position:relative;
  background:var(--btn-border); transition:background .2s
}
.switch .thumb{
  width:20px; height:20px; border-radius:50%; position:absolute; top:3px; left:3px;
  background:#fff; transition:left .2s, background .2s
}
body.dark .switch .thumb{ background:#dbeafe }
.switch input:checked + .track .thumb{ left:23px }
.switch input:checked + .track{ background:#2d72d2 }

/* Table */
table{border-collapse:collapse;width:100%}
th, td{border:1px solid var(--border); padding:10px; vertical-align:middle}
th{background:var(--bg-2); user-select:none; position:sticky; top:0; z-index:1}
tr:nth-child(even){background:var(--row-alt)}
tbody tr:hover{background:var(--row-hover)}
th[data-type="num"]{text-align:right}
td:nth-child(4){text-align:right}

/* Covers: de-bord cover cell + image/button */
td:first-child{width:72px; border-top: none; border-bottom: 1px solid var(--border); border-left: none; border-right: none;}
img.cover{width:56px;height:auto;border-radius:6px;display:block;border:none;box-shadow:none;background:transparent}
button.cover-btn{display:block;border:none;background:transparent;padding:0;cursor:pointer}
button.cover-btn:focus{ outline:2px solid #2d72d2; outline-offset:2px }

/* Cards */
#ab-cards{display:none;grid-template-columns:1fr;gap:10px}
.ab-card{
  border:1px solid var(--border); border-radius:var(--radius); padding:12px;
  background:var(--bg-2)
}
.ab-card .t{font-weight:600;margin-bottom:4px;display:flex;align-items:center;gap:8px}
.ab-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:4px}
.ab-chip{background:var(--chip);padding:4px 8px;border-radius:999px;font-size:.9em;color:var(--text)}
.cover-inline{width:40px;height:auto;border-radius:6px;display:inline-block;vertical-align:middle}

/* Pagination */
.pagination{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.pagination-info{color:var(--muted)}
#ab-page-nav{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
.page-btn{
  padding:6px 10px; border:1px solid var(--btn-border); border-radius:10px;
  background:var(--btn-bg); cursor:pointer; color:var(--text)
}
.page-btn.active, .page-btn:disabled{background:var(--btn-bg-active); border-color:var(--btn-active); cursor:default}

/* Empty state */
#ab-empty{
  display:none;
  border:1px dashed var(--border);
  border-radius:14px;
  padding:18px;
  background:var(--bg-2);
  color:var(--muted);
  text-align:center;
  margin-top:10px;
}

/* Modal viewer */
#modal{
  position:fixed; inset:0; display:none; align-items:center; justify-content:center;
  background:var(--overlay); z-index:9999; padding:20px
}
#modal.open{ display:flex }
#modal .panel{
  width:min(960px, 95vw); max-height:90vh; overflow:auto;
  background:var(--bg); color:var(--text); border:1px solid var(--border);
  border-radius:16px; display:grid; grid-template-columns: 240px 1fr; gap:16px; padding:16px;
}
#modal .panel .cover-lg{ width: 100%; height:auto; border-radius:12px; display:block }
#modal .meta-grid{ display:grid; grid-template-columns: 120px 1fr; gap:8px; align-items:start }
#modal .label{ color:var(--muted) }
#modal .title{ font-size:1.1rem; font-weight:700; margin-bottom:6px }
#modal .desc{ margin-top:10px; line-height:1.45; white-space:pre-wrap; color:var(--text) }
#modal .close{
  position:absolute; top:14px; right:14px;
  background:var(--btn-bg); border:1px solid var(--btn-border); border-radius:10px;
  padding:8px 10px; cursor:pointer; color:var(--text)
}
/* Link-style buttons */
a.link-btn{
  display:inline-block;
  padding:8px 10px;
  border:1px solid var(--btn-border);
  border-radius:10px;
  background:var(--btn-bg);
  color:var(--text);
  text-decoration:none;
  margin-top:4px;
}
a.link-btn:focus{ outline:2px solid #2d72d2; outline-offset:2px }

/* Responsive */
@media (max-width: 820px){
  body.cards #ab-table{display:none}
  body.cards #ab-cards{display:grid}
  body:not(.cards) #ab-cards{display:none}
  body:not(.cards) #ab-table{display:table}
  th, td{padding:12px}
  input#ab-search, select#ab-sort, input#ab-page-size, button.btn{padding:12px 14px}
  #modal .panel{ grid-template-columns: 1fr; }
}

/* Make table rows look clickable */
#ab-table tbody tr{ cursor:pointer; }
</style>

<!-- === Inline Author → Drive map (no fetch). Replace with your full mapping === -->
<script type="application/json" id="ab-author-map-json">
{
  "A. American": "1XRRVYWv3Ys4-5BGnYmTis1L2WlqAyuW9",
  "A. J. Finn": "1aXkdGgjqwPetePn4oOMNSd01OPXr12mK",
  "A. J. Pine": "1X8tUejTnSQQDgAYNfF2ALIXSujwlDEWj",
  "Aaron Shih": "1N2epF8nQWOC9p6Y_FE8omm7EiGhVZMNa",
  "Actus": "1ozy0b5RFWWhG1zUxOUQ5binvbxl_wdlR",
  "Adrian Tchaikovsky": "1NN3SWdONFrWHrfdreFcBYiEIe9rgtWTg",
  "Aleron Kong": "1e49Fli5YJ-gWc8OTxG9KmBry5CWVWjxz",
  "Alex Aster": "1idA4_l_Gki6iAYpDV2vONdhxnm3SyGTj",
  "Alex Michaelides": "1Iy_pZGVqci4cBN_0hWujFutqX4Tl-w2e",
  "Alex Toxic": "1rNyOeWWzjeBebi-0NIfJZb_-wUaihaVR",
  "Alexandra Bracken": "1mdEzML-POGcYddPJ_ZYzcVmwjiuLJTrw",
  "Alexandra Silber": "1WjjGoDL4I4GgVU-csM5dccH1StSMFSJP",
  "Ali Hazelwood": "1q6XzqK1OEjgSHUV6Z5b4_Yy4MxmDN8YH",
  "Alice Feeney": "1Ovo_ck26nnp92c4yfrFuj7sJsZsi1TEX",
  "Amie Kaufman": "13Ccn7rX7ZLr78yb4CbOOQm9IRQMTY3p6",
  "Amélie Wen Zhao": "160JbDfnOm5RDFhLpuWjvlSuGIbtvu5p3",
  "Ana Huang": "1Rj3Bt7K6eVo--n5s8NF51kLINd5F6lUa",
  "Andrew Rowe": "1l1kIiIKaKGGOZw_0UxYNEcx5hjoLkUb6",
  "Andy Weir": "12eU3DwLXsEyin3bjKcMc6N--8YGKpsG9",
  "Anonymous": "1NY5YTVzY2B986OsuIzNZ0Em2uaxx21mx",
  "Anni Taylor": "1OMj6M00d_AABPYoQErUprDd1YjR-lPvb",
  "Ariel Lawhon": "1qB19zFiXNghw9JHMUru7XyVQaD8G8p51",
  "Arthur Conan Doyle": "1Z4-KE0McQlKH9joaWu_JHknqXsqa5zcn",
  "Arthur T. Bradley": "12NZSdlygNPbv5NA4gQ-BN11JWwpvU6AF",
  "Ashley Poston": "1fzMuutEXTEYPe5F43nHb5fVDeJfdYhmd",
  "Atlas Kane": "1_R7rh2MF7Qi1i_hkIvOulmfHhbpwK-OT",
  "Bastian Knight": "1bdeLpy6aTWqMN-PKUWpbxxCz9dB-oiCT",
  "Becky Chambers": "1tY0doGwE-Tcp6WFAxvFt6KoGRuYkj7nB",
  "Bella Forrest": "1ufX3BVhmVQDMV7bQMC5n2KPWrKoNCcFZ",
  "Ben Garrod": "1bk6reDBLuTZESe2vifZys-K0k1LiYPCu",
  "Benjamin Kerei": "1w7r9sJ3K5FsCHILst1oYV3F57TQvvXZM",
  "Benjamin Stevenson": "11WTIv2b7gnEk0Pic5G89g8-jBbWr4Q2v",
  "Blake Crouch": "1B78kgkDfWenQxsVnixjodIJGcv22Ouyl",
  "Bob Newhart": "1cEb6ySXYpuC7Uidas1aKOcJroc86NS8P",
  "Bobby Hall": "1PLiNxLWehgtbUfICz82YLDtImwUd8mi-",
  "Bram Stoker": "1jsriC-Hy0TmvteKpuRShne3eIyqWBUas",
  "Brandon Mull": "1bbY_TtKw51ns84r5BUJ7-1FSeLWlKP10",
  "Brandon Sanderson": "1Gv-ImmYduWqSCeju2b9dqkqEV8pNBVyW",
  "Brandon Varnell": "1pQGewJtyt6k1CLo8yuj1bDZ_uK5rotsh",
  "Brené Brown": "1a9tGzCfpUAd-yy_ISXBEaLgbpkiVjekR",
  "Brian Andrews": "1q1UAX43WyQY4Q26-gg0AJiZ-DiCPhA6x",
  "Brian Staveley": "10kftEF9KAJrVSUviFN79x1BONoGiHq10",
  "Bruce Sentar": "1vPdkNsqeXsQdC78P6pZAvCvzOVQTc3pw",
  "Bryan Burrough": "18Yp9nybpiWLVeR80qJe-CxbWVhDIaJkB",
  "Bryan Stevenson": "1Ewulrkaf8R_DdQXpnQPp0ily2o0zNIlj",
  "Brynne Weaver": "1Dd1PO85msOFlVaZf3jvreHk0Lr562YYM",
  "C Peinhopf": "1iNg-NKUlDkqM8egJh-5hg-3rFgGfDv-B",
  "Callie Hart": "1dK35u2pXyqw8aPlU7QrIJDEHVujit7Qy",
  "Cara Bastone": "1GzeJ5rWAGGj_px-ektkVRQ5gOJf-7uxa",
  "Carissa Broadbent": "1ROvlFLsbrtup1kawihWvFlzzzewwgA-W",
  "Caroline Kepnes": "1M0rTqSuN1xD9Zg8SmBYgmSbSWF2zrjRy",
  "Caroline Peckham": "1KLv6J4DWANYjJ63xkxK2AABS-oEQF2Vs",
  "Catherine Steadman": "1K99DY5BBiAaXXP2JXZ4EPvb-v3TYF5G5",
  "Cavan Scott": "1gf5vhjjsKfpZoXB3uJbKiHW6UiPjBlyB",
  "Cebelius": "1pC-L90wUNrzSn14uMZ4hRQGYI19mrZ-v",
  "Charles Soule": "1WPp_rQ5XovexEoI845L2SG9UPryuxjFo",
  "Charlie Donlea": "194-2TOFONnvd6k02bpa3jzqAn0NuD_Nt",
  "Christie Golden": "1ZGQXcdqq_t71GtqYVk0c-gNV0ovFcfpB",
  "Christina Baker Kline": "16Dsnweh0mTXie-7EEnyk5sdsbDzuQ8iC",
  "Christina Lauren": "1qRigbA4Il3as_j-sCW92zPfDjK-FkZdn",
  "Christopher Johns": "1zuryDGL9dQEfbqKSv0alK4WrRK8Dt2cS",
  "Christopher Paolini": "1rSjyZ-G9Ddt74dNoQQxeLrqwAb9z9XJ6",
  "Christopher Ruocchio": "1_1QGzHOA6emxKm0J0uGTH5-zC5ANGRmw",
  "Claire North": "1CIeGNwSaNXHGFqfzBFRUGxB70rt_iP_F",
  "Claudia Gray": "18ln6onLKT0tx2yPH_ogJ6bihYsejrJCU",
  "Courtney Alameda": "1VtpEIPurJNF9cFK1IIbUgsGSdrAu--qp",
  "Courtney Cole": "1WoGyml6FGK9FZ5mgvnkd_AJ2O1HgrCrf",
  "Craig Alanson": "159CJTi4RqlJFclhZlSy8KRV6V_ZpMsAI",
  "Curtis Sittenfeld": "146coInKbOLGpU9meHPoopcAlVqJTO3w2",
  "D. J. Palmer": "1xpqAQ-uC3UFCVMJLRNpAZS3S0TQH7jSa",
  "Dakota Krout": "1Yn7MU6ZxSaOsfQ6bvpqmUFziW-LHalkl",
  "Dan Wells": "1aOp4_KDr8VGCZDon2auEloME0zjnMl1k",
  "Daniel L. Everett": "1ohmXHRMpg8iknYggbD37JKZJvw-qq4mo",
  "Daniel Schinhofen": "1iaIsOWI-7bWoy-YLfaasByS2H4Fjw9mM",
  "Dante King": "1dn2dc0TpLxGphC9v3YItj9JXoTPdghaS",
  "Dave Willmarth": "1AWnoNznl58rncFbPiSvHr5odUZQomLWj",
  "David Levithan": "16PML1SF2sHzcpvU3k-LGIDSJF0sU1fDw",
  "David North": "1vgHp4jxuVzIsY5f3vhj31Na0W2SnEqRn",
  "Deck Davis": "1XBbjQiCqdDVUTlcD7a-rEahLzHj2-opN",
  "Delemhach": "1E1iHDIZH2e8lFwP2w0GU-fh1RjmXVQIK",
  "Delia Owens": "1V-G-phEnX6ulIT156S7Tb-GeDNnFqqcL",
  "Derek Benz": "1Th_dvs6l48Hf3kstaFvqaE4bT3rOb_wA",
  "Django Wexler": "1kweFVTxzfOYQCyA-DBMXlvjumCDur9fd",
  "Draith": "1aRwz3Aes-NCXJLp_fvF7cpWF8lit3djO",
  "Dreda Say Mitchell": "1u0M-EaCqVM5z-V7S9IaZviQhvAaa1rN2",
  "Drew Hayes": "1mXVedH-lnHIlMcuYWsYKVBT2Fj-4kC-L",
  "Drew Karpyshyn": "1F_9uxeHzR9vqn96JhmCaw3XbjNUKhQ5o",
  "E. C. Krueger": "1Kvyro7qgXewa8cbBu8Ei3fE0nDNdZajO",
  "E. K. Johnston": "1NXaDark6ESBEL_ZHkhoeFTpfJE9lAe2Y",
  "EA Hooper": "1AjwIQkQh_cyr5H38_SlkZlUmkwH7LlNI",
  "Eden Hudson": "",
  "Edgar Allan Poe": "",
  "Edward Brody": "10PbuVrFFahl1yyRkKj9Yyqh64Uv9D_GO",
  "Elen Hopkins": "",
  "Ellen Hopkins": "1OYhvCzG7ALrrmRoQexOfdOaVSnsRBxif",
  "Emily Elgar": "1KKFTi92SmGldGPPYObqczIHOLuV8SGzq",
  "Emily Henry": "1I4IlJq1Z5dVIn9ig4N5KaAiUr6Fdu6iH",
  "Erin Ampersand": "1wkryDxKoRzBwGbYMhmwTH0zyEkKKYGqN",
  "Erin Morgenstern": "1bE51VUWQDpfddTnv_mySRTAPw2K0PJeK",
  "Erios909": "1_Pl4D6qQM4JonHFgHromq92-6bSRO1bF",
  "Ernest Cline": "1mnHu1dvb8J9yb4XrHNP11VenFGOVvXmr",
  "Esther Perel": "1n53Xr5_17qE9c8K6DsK9WSseVO2Ip4EL",
  "F. C. Yee": "1YZXLK7am96NSblaDkiWhbjF3SPTSFrDs",
  "Francesca Zappia": "1ZAenMLjhiG4HYwgim8hZTGwvqWpSQEvO",
  "Frank Herbert": "1KVELaPZhnM0hteE1C3Vqwxcch_-WOGuv",
  "Fredrik Backman": "1hwnH7G17SF_ASA5QRzCxzKKTtjuZOEVD",
  "Gail Honeyman": "1WCdgdohJsCHEvjE_TulauGaOp3nNkgYU",
  "George Orwell": "16SxDHKA9kWf2mcC9SZ_aFnevTgH9xKAU",
  "George R.r. Martin": "1zhVUxHzqi7Q4FeBCG6AhkQGrykgsY50M",
  "Gillian Flynn": "1D7wHEzJEmq1s95GtEkF8VzHuiR_PEHyU",
  "Greer Hendricks": "1lglpKDSIt0ifgWCqUXCmBNAYeHWYDvja",
  "Gregory Allanther": "1ZE2vj5cnEhTQCzlWChotSd1AJV5vWgFW",
  "Gregory Maguire": "1nKWQg_ZNHHOgBtdib0upNuEaZXhROx2l",
  "Guy Haley": "1VJUwCxIfAw9wZ0VMfgterCljOqg0ERX1",
  "Harmon Cooper": "1fJMrWO8VobZWllN0pHyXd6YFSAHpqgmR",
  "Harper L. Woods": "1CJ6WkbvdLyhvT6k2DyQ-2SucJhrOKJmb",
  "Haylock Jobson": "1yzhQC8rYkmreTMap5K--6MXE0OCW1Okp",
  "Heather Fawcett": "1FlK6vE0QXhZilI7KKYe4NWxkM3vRpsZo",
  "Helen Harper": "1InZCnm6f7V_N81KowPZwcmYMrzDgOxcD",
  "Honour Rae": "1ShL5pxKFtnIW4GjaPTOlTZEoSBTlq741",
  "Hugo Huesca": "1-s4RKGDaHz1Z-GVK4MHcRZIXcRCjkHhy",
  "Iain S. Thomas": "1pXautLq10xo9QYAu4EXH3j9S6EM3xira",
  "Imani Erriu": "1VfQRA6QXWQoNVQHj7tRhAtq6pn1-KsRw",
  "Invayne _": "1aHMaHw5zh5c1nczB3omqwjG9J5LuW85L",
  "J. P. Pomare": "1ljF5L7OaRAQdsmvnHVuaGIqBBDIrb6Zo",
  "J. R. R. Tolkien": "18XgVGd5bkMKVWcHJgqycz7M-TvPOrycq",
  "J. S. Morin": "1RxgW5wuzD44Wc6NTWQG21C-7HAK4xaS7",
  "J.r. Davis": "1Y0Lu3OkfuV1Kp0hOK5shOOU7ILnv0Qyy",
  "J.R. Mathews": "1h7rCrpljKmcwyy1IklklDhUFm08D302m",
  "Jack Campbell": "1vUp7B5bJqR7WjXLnwzodqhMcpYnhL6fH",
  "Jack Gantos": "1X7T-Z65AcWFsups4Tqs3kwfCnivPtA0T",
  "Jaime Castle": "1BD_s-kklov5Ic7ImocgMb3dmCaCsAWAH",
  "James Hunter": "1ojTnMPa_God1AZWXWr-Kl7h1eDn-CDxw",
  "James Islington": "1U5oC6BtPhsFEcEE9JKj_luaL7wJ4qNun",
  "James J. Butcher": "1iqnv1OPDjOTOMuaTfH-N_tqitrOSYtnz",
  "James Luceno": "11d5lZVD7tvqkHtPKMT7t35d2KFuw2oKz",
  "James Osiris Baldwin": "1snqE0zSTYvQNE3PV0rJHhB6Edq7pw9hu",
  "James S. A. Corey": "1fl-E1p4x5_TCq9vmH0Xm9pD1H6s7Q0oI",
  "James T. Callum": "19WvDQFUz9P23BZxLBR-G_Qb8YoP4X6l3",
  "Janci Patterson": "",
  "Jane Austen": "191eBHRGiK6PBqpvYiaySj3XMkNgGWlRa",
  "Janelle Brown": "1veN1onLgKqG-Lcet8kxCm8JmMU6enrx3",
  "Jasmine Warga": "1bx3ENqEdObZkeoAKHtEXafuo3-G3GuoR",
  "Jay Boyce": "1b8jGiWBxGKe35xVDXNsUx91pOltOVi9U",
  "Jeff Wheeler": "1Es8D4eYmYnSf1iADsK4Yw4TRd7Jp3-9F",
  "Jeneva Rose": "1FH-hLOnlpTJGEk1oSdv_m4-WH5-J_inh",
  "Jennette Mccurdy": "19LffmYTdGq3AWEb7cTE5-1J3ApFfunrM",
  "Jennifer L. Armentrout": "1PtwECy00ZdMbDi7EdEEhBUCK-xqTSAxt",
  "JF Brink": "1MWLh2vj2W4aWWxCQnOEr31XfQni2gpJ_",
  "Jim Butcher": "10lbe0eUksFAPeSh6A9RlMnyphvH8b70A",
  "Joe Harris": "1fAKs1MDhQoJv-rtMsyN7pJ7dQAXnJP6b",
  "John Scalzi": "1L_p2OGZRYff7_ZYn--WoRTnPIJQ43T8S",
  "Jon Ronson": "1LMeCoHIMK_XvmTjLLAx4ERynJTvEvtzQ",
  "Jonathan Brooks": "1mssi3BMt4owPPDSVOtnVOYxkXuoSVLaM",
  "Jonathan Maberry": "1yf55X_dmKSfopwvAfabudo9mlzsz8c-7",
  "Jonathan Renshaw": "1pnw38AORrDw8itYEdtqiKOpIwiSDzV8j",
  "Joy Patrick": "1ea14LdZC0f2bjXQHXO6lXaF7lxJ_OCSG",
  "Julie Berry": "1-c-0xfTwoXDVYPd-GDeAmrbwv7Ef5N4Q",
  "K.t. Hanna": "1WWJ4yuQLkaotF-_7mvXoud8cmTabXDWy",
  "Kami Garcia": "1E9pbDNOk1INwhx6978wlZgd2AnAoBpF1",
  "Karen M. Mcmanus": "1gs75-G-YriWxhlN74fXty1LKpM0bJpxQ",
  "Kathleen Glasgow": "11f8srSPQ9VtM65MvUTVXI3NdVjDnjaAN",
  "Kate Morton": "1QKehob1qMpsmdSOpRjEqE7q4Yx-0zRk_",
  "Kaylie Smith": "1PucNWiLzj7kZh1_aTpw2cgBIPqkxTUhZ",
  "Kel Kade": "1cGTuquirxLHeJWW2UUyOVi-OqN88OetG",
  "Ken Lozito": "1IwOYjMU8f_1ybXJDt6KteMH6etf4t-h5",
  "Keri Lake": "128M6g6KxBU-lrMzrhWL3MTgOmoqEakvm",
  "Kiersten Modglin": "1wdD99DfqODFJ8e0ks44nAzVZyuSDXhuf",
  "Kim Harrison": "1dKCVtxCuSOks7v7tIEOApAXKSiI5ikF2",
  "Kimberly Belle": "1qqspQX-Ulf-83-gHsXAaGTB2DhkyoK4F",
  "Kristan Higgins": "1BP1neBMReT6zcThLcK-3UWwhS_HS2dep",
  "Kristin Hannah": "1hxT4tubNadcw_geo0tKex9G2mbCGrKz0",
  "Kurtis Eckstein": "1wtvKsZ7ETcjWMX8aAZQAeGoPsCilIeRd",
  "Kyle Kirrin": "1eEZxjnoFfpT-ZSAfcqKuvLCAbHSEnJLo",
  "Laura Mchugh": "1No36LRYuJUoyBB6-ROxElgldmDoz2CSX",
  "Lauren Blakely": "1IkcDpdovAUKrGEo5s_Kv3cYX1xQaYMj2",
  "Lawrence M. Krauss": "1fxxu1K9T--Ag9Amt23VirQZ6SOnHacRz",
  "Lee Bacon": "1YVEB2Ki6AHklCzZ0KZSgZJuNhagqU8gJ",
  "Leeanne Slade": "1Hi36A7tOqeY5FlQslr-HhetGNcKLsFRZ",
  "Leigh Bardugo": "1D0z_6CMEl1LQ0YrowfV7jfMROXkciHMe",
  "Leonard Petracci": "1RsPxSq1zujPAwQmwibgAQ65far_4YoMk",
  "Lily Chu": "1yNmP9tCP9bHsE17J24pyjuf-pyvhtmN4",
  "Linda Keir": "1sfoy4fP2HtoJrCav7sAbSY3grsJJlmoY",
  "Lisa Jewell": "1sMrFa6ViJfa8WYGyNzsKBNxQpzwpR_C7",
  "Logan Jacobs": "19AOj1xRdVmeN6og-dksryJU5qAAy8V-N",
  "Lois Lowry": "1l_oE13esoZT4T7UTWXgz7DHL_aJ7Lpkb",
  "Lori Gottlieb": "1L9WInZZyUxzqlfxOoJRcgVhxRX-UJTVH",
  "Lucy Dawson": "1q8usGUv9p5EeEIYQSFWAX0V1d-ehYcOD",
  "Luke Chmilenko": "1tp0eYUg_hll4722nfmLfdZ-qnmECN1Y2",
  "M. R. James": "1pWma_rKSXbUw6XNlq0FOEtUZQsWH8RL1",
  "Madeline Miller": "1BtBPILC2gCNVgOPFjGCWLUTYI1QsyRtr",
  "Margaret Stohl": "",
  "Marni Mann": "11XpZCm-ozMZv9kG_p9NHTFgP9ucThNLc",
  "Martha Wells": "1cpRfbpCiLyLotm7U5E_4pN6O6mnuhYWn",
  "Mary Kubica": "1uzINhn5_eBfK0OeDcnOfprJyT8tK6IkI",
  "Mashton Xx": "128Mnh4la1eEeIlZF4UjTfM7prlZuNFCj",
  "Matt Dinniman": "1OqVbpSMKOl2UQvpR_mPKI_RAfs8Y12rF",
  "Melissa Mcphail": "10e0K1qck7cKOI07L0qMBVsQ6LtKc7wfr",
  "Michael Chatfield": "1bQCRcoq3K7UEYG-ZTwbv0hDYmlLXTDh7",
  "Michael Crichton": "16IVaP2yjMGshlDzFhkxLJrQKOppRWqn6",
  "Michael Dante Dimartino": "",
  "Michael Head": "11S5xyeH-49N_TaQqr5Rv0hZ2GiRPMVjg",
  "Michael Kardos": "1oZ0XmOSKV3_YGc7gMcANwpSjL8R8bzgT",
  "Michael Livingston": "16uzuI2FoKK3SQyxLashMWizG0za7fQTK",
  "Michael R. Miller": "13rWpF4wNGigwQE3nlohEaqyPOKkBpBdk",
  "Michael-scott Earle": "1ezlT3xddP5SHVnalBvqSYq9MB3sBFvOC",
  "Michele Campbell": "1k3kPvm4TMAjJwqvbKNtengYbLYJUimrM",
  "Mikal Gilmore": "1gv_bonnIJE9ZqYhJ9G69vQNst-ev52A9",
  "Mike Duncan": "1p5mBsvFUJjlYlJg3_SYXY7iXsT-Afk5L",
  "Montgomery Quinn": "1qPkAUef4QUHmeazFuFUbkqhx5H4sXzJt",
  "Morgan Taylor": "1cwoFaV9ewrzFbrRHu0gdmPadDUug7ce2",
  "N. C. Lux": "1rXNDnskqQisoW_2o7K8UvGtO9zqEOjPF",
  "Nadya Lee": "1rNyOeWWzjeBebi-0NIfJZb_-wUaihaVR",
  "Natalie Barelli": "1Zx7c9W7RE6EBEPh7wq5xKxDWKPl_dAyr",
  "Natasha Preston": "1XcaWcC8KjCQrcAGlgwE9Mdw2ftVAI17y",
  "Navessa Allen": "1QJc0RP0L4byupepioDvO3RtxfNfWCAZT",
  "Nazri Noor": "1gz_1y0883N6YoWq9SC2OkLJmIbX9QtQp",
  "Neal Shusterman": "16CAGrifTHN220avnUbD3VjE66lhTI6AZ",
  "Neil Degrasse Tyson": "1LQtoxMK8W9siJG1JcDvWyenNwpH0KbPX",
  "Neil Gaiman": "1woInxq3A5RGT6bQLW8BdmF6SoNqsU4aC",
  "Neven Iliev": "1UZfgK8zaSaiAVZMSgb4Z3Jzzy9NCz86r",
  "Nick Carr": "1FI8xvNiiFC4-m9EQ3NkbV9qz9iUPtY9-",
  "Nicoli Gonnella": "1vK9BGqY_gtbtGrc4aXxktazDkma3rYB4",
  "Nikita Thorn": "1iNiR9NWFgPLfaG_FVS5HrndrIdGQmXqF",
  "Nora Roberts": "1Tibu-2tw5SQGKmaXJH04Vo7Rj2Ikul7S",
  "Oliver Mayes": "1xAq5Au8B4sLi7QApG31VU3CNB1BMn9uQ",
  "Paula Hawkins": "1W4k_CDUNFLmk35mWx6hhsZmUfbYVhHsm",
  "Paula Mclain": "1PuHCrEJG0iBFoIkDqIDYLeNml41pqGND",
  "Penn Cole": "1ax1hCQ31xi9DcclkQNPcydVA__qOR13X",
  "Peter Swanson": "1CFEs08s4--LwCeFvgmuabNRMSdDcFxvg",
  "Pierce Brown": "1bAXREspVYCipbg8WgiEP4PNT9DYD4-n7",
  "Pirateaba": "1Ym_PZX1ofr6rYAgHipDJhaomu2BtS1dN",
  "R. E. Mcdermott": "1CxydNymj7J-N_gKXuGriPf_Mt3KVyMfQ",
  "R. L. Stine": "1nU9jku1HoBU0yAf56DQMt88H4SuhrYXQ",
  "Rachel Gillig": "1btSoy7IMPZIAWazSW5tLdblGvAOd5ac6",
  "Rachel Hollis": "1hf9frpos7PCq2y6l6b2vfHmuCV2MSTPW",
  "Rae Nantes": "1e_MgwC33HIk6ykCsBpuZZb9PKxK7Sgdm",
  "Randi Darren": "1-R1KBlGgSUZkDI98z6unZhqaqvoLtbO4",
  "Ransom Riggs": "1VvEv5p1OvQZo1Z5e-_NRIgubK0yUorTD",
  "Raven Kennedy": "1UzFtVvdIsmgr0ohiUkm_nFiWYdcv2Cw0",
  "Rebecca Skloot": "1RVCPVxZVkhlbz_xgAKtR-URJiUnlHRTo",
  "Rebecca Thorne": "14Gb-FhI42z5yxNYFEmFuLcf3eX7i2EZY",
  "Rebecca Yarros": "1yMadzAh3tl_DJg4qb_yeEB9BHkch8vnW",
  "Rhaegar": "1go_dgkg9WCew0aNdf_GIUJs2wRma3t09",
  "Rhett C. Bruno": "1vIN1mJF2TyJAOOJTUmEmjA7tq4rJxuNH",
  "Richard Osman": "1AzEe1uf_kUbnwEErb-uRFVIzhqL8ZG8y",
  "Richard Rhodes": "1jpkEwQ5S4mRUIBz3O6Tz9pRplkXqFEVS",
  "Rick Riordan": "1TrLTCyCfP0rmqUtrzRtYZ7ueYw6LkDR8",
  "Rick Scott": "1BYnhFZ6gDIbzb0EKx0I0gH5hqjMvx9qH",
  "Rob J. Hayes": "13euy4VCQtWg741-zoRNDoLe601ugnNM-",
  "Robert Dugoni": "1FFLDmwCm2FSRTRuZtkO_Q7oXRuV2E5K6",
  "Robin Hobb": "1fqMyc6TZDt_Y6T58JlGnpuPKdYzgTX1z",
  "Ruth Ware": "1-xu8p9PO4xwmPjnVMGQtetuGEUs3FvHI",
  "Ryan Debruyn": "1Ch0k6BAGnNc8EsIQZO92i_7WlYIj15r1",
  "Ryan Silbert": "",
  "Ryan Tang": "",
  "Samer Rabadi": "1szSWwu8eCMYsyKkOA0pRWWdhsoiag8vB",
  "Sarah A. Denzil": "1pKmVEGhmAR5X6OPuGDAvk0NVOOa58ATQ",
  "Sarah A. Parker": "1t0tucQFu3bKzVPDLyChlLMCV-O7LbmEa",
  "Sarah J. Maas": "1kKRqViXbqFsTp7mV4K43AhnTH-pDh3mG",
  "Sarah Maclean": "1XEoDLmIqc6ddpd5NNiA-rFhWeKqctA9g",
  "Sarah Pinborough": "1laicEkAkQh4es09j1Si5nlZLRy7jvHE5",
  "Sariah Wilson": "1rzVjnlu6Mf6ygkWMn-3GTmZZ-prU2-jK",
  "Scarlett St. Clair": "1YyT8f9WpgBl14x2rLj_n0dTrthKKaJ82",
  "Scott Baron": "1hvHGb1KWDw_tAxiBH1xcyAnu9iLfAX4q",
  "Scott Meyer": "1H2NfFB1Mx3rVnVMgvlCyUWLvZMD0AtEN",
  "Sean Oswald": "1p3hHlCG43uCd_1y7gzT-6tUABqzx7GHb",
  "Selkie Myth": "1ogF7G0MWoOZwoTULiEasI8HRt_ALQE_2",
  "Serasstreams": "1lRXV2r_IVnCah6zQOTl3AvMFP1cgGKff",
  "Seth Ring": "1NRILjSBeA7J7eOlDLRocIF2s-QQ23DBo",
  "Shami Stovall": "1EJfUtEWS3laLfyca1QHFEuEBxdp09cFC",
  "Shannon Chakraborty": "1brAdNQohOeQRK_5NLK2MHi4QHjvW4AXp",
  "Shari Lapena": "1ZJWrlIL-CrlEo812-H73mpIitwjRQRu4",
  "Shemer Kuznits": "10m6Z5Ib9ZiXgsqjRH_YUEQwavlaO7LK8",
  "Shirtaloon": "1cC81--dTGxYW2Cyfov587cVNLLyO9Jg2",
  "Simon Archer": "1kJc1GweJGjNji0aF0AG0A_tr3hsHeyHz",
  "Sir Bedivere The Mad": "1gRDJ2KLpYklbSnUt6ukSCveCLY__Zi7t",
  "Slin Jung - Translator": "",
  "Snoop Dogg": "1e01zhFwI0NEXxSImIKOVXZg5X3ewsOUk",
  "Stan Lee": "1kP1jaXqQyUUhX-NChkAW_P_EW77MLv8j",
  "Steena Holmes": "11IIKt1pZQ7vMRL-c0AZv9C0gWUq5Cgyz",
  "Stephan Morse": "1jqg9Q5kvvliFZsUUmuLF2bfKxFlykpnL",
  "Stephanie Garber": "1GQuRakoxwYvHXp-ur_G7nYJu7hYr93PT",
  "Stephen Fry": "1nkYTxFezxpYSJZpDWVkC5O6eKeIzTZei",
  "Stephen Hawking": "1ZjFrzuZpMvR3rpf7LDEZ6NcVn5iTeNwk",
  "Stephen King": "1eDmQDno-huFIkiBxt9n68RNir-umWOh0",
  "Stephenie Meyer": "1ItYOtibGVrf0SK7QRgl1dHWMWycJNGCs",
  "Steven Michael Bohls": "",
  "Sue Watson": "1yGLe9DOtSRQTXKi9Hg_poktzK4bMaZCm",
  "Susanne Valenti": "",
  "Suzanne Collins": "1Wbow3AbnbmiV7mv1IQpPESE2iXbyC8k6",
  "Sylvia Mercedes": "1rAq_fMDouhOzBs9UI1n7OwftMo9IeOJl",
  "T. L. Payne": "1IJsLEnvLghFg7e-wZ8n9QnujNoaIY-GT",
  "T.w. Piperbrook": "1Cp8_OJlgyJeidxLVK4Lf1TYv-Hhg4N1Y",
  "Taniko K Williams": "1-v04dL_cVXLjwGqmgW3bZF4lut85B0SF",
  "Tarryn Fisher": "1dJOZDzPq_OYW3crTJBSG-0_cASLY0rJJ",
  "Taylor Jenkins Reid": "1BOBse9Lx-Hb77XIQBFkxqet2CeKM-3aI",
  "Terry Mancour": "1rXBCuOC78WFBjiGNCRFtt07zuIO9LqIa",
  "Thefirstdefier": "1ypSZk_4XzxGJCMpp3XJgdWM0SFrnoQ8C",
  "Tracy Gregory": "1TbJHq9z3lBc1KmboXqKc3kHc-mXL4Y9w",
  "Travis Bagwell": "1emSJjFsovFE93irV1mrwWXUbv28V-P0s",
  "Travis Baldree": "12Mv1sD8W1g9dzfb-xJqCn3oeA_xN1Ju8",
  "Travis Deverell": "",
  "Troy Osgood": "",
  "Trudi Canavan": "1ESaL_XCCwuOoDRDocttuwVDW37VxtEsQ",
  "Turtleme": "1Wt9Oe1mrZ0PTnxU4JG1P871y4fVGrDmr",
  "V.a. Lewis": "1YMZ2DAogOppQ21hpwe8JTS2ZLH6uLIxI",
  "V.m. Straka": "1hKgbbEnbIL4TBeAvSWSMVo3dZqdxcxML",
  "Vasily Mahanenko": "1o_iuSmX37JCxOYZ5sRnuvCzqwiTPq6r4",
  "Victor E. Krabin": "",
  "Wandering Agent": "1FOAeSuCPf5vLJEtr6NS1AcD0V84F_w_B",
  "Washington Irving": "",
  "Will Wight": "1lDsDcmMfL1sdCkQFuw3CB9E8Xyfw3pBp",
  "William D. Arand": "1-R1KBlGgSUZkDI98z6unZhqaqvoLtbO4",
  "You Yeong-gwang": "1HZz3Te9w7mSIPCOiu5zEy8qbiJYNOSva",
  "Yuu Tanaka": "1IuYfJGd_cRFoR3CN2OwTs974D9bkeExu",
  "Yulia Kuzmina - Translator": "",
  "Zogarth": "1VYMu7BUZm_4ENNXs5ylUvk2qsqqwsxze"
}
</script>

<!-- Optional env hook (unused here) -->
<script>window.AB_AUTHOR_MAP_URL="{{AUTHOR_DRIVE_MAP_URL}}";</script>
</head>

<body>
<div id="wrap">
  <h1>Audiobook Catalog</h1>

  <div id="controls">
    <div class="controls-row">
      <input id="ab-search" type="search" placeholder="Search any field…" aria-label="Search" />
      <select id="ab-sort">
        <option value="title|txt">Sort by Title</option>
        <option value="series|txt">Sort by Series</option>
        <option value="series_index_sort|num">Sort by # (numeric)</option>
        <option value="author|txt">Sort by Author</option>
        <option value="narrator|txt">Sort by Narrator</option>
        <option value="year|txt">Sort by Year</option>
        <option value="genre|txt">Sort by Genre</option>
        <option value="duration_hhmm|txt">Sort by Duration</option>
      </select>
      <button id="ab-sort-asc" class="btn">Asc</button>
      <button id="ab-sort-desc" class="btn">Desc</button>
      <button id="ab-toggle-view" class="btn">Toggle View</button>

      <label class="switch" title="Toggle dark mode">
        <span class="label">Dark mode</span>
        <input id="ab-dark-toggle" type="checkbox" checked />
        <span class="track"><span class="thumb"></span></span>
      </label>
    </div>

    <div class="controls-row pagination">
      <label for="ab-page-size"><small>Rows per page:</small></label>
      <select id="ab-page-size">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="50">50</option>
        <option value="100" selected>100</option>
        <option value="500">500</option>
        <option value="All">All</option>
      </select>

      <button id="ab-page-first" class="btn">« First</button>
      <button id="ab-page-prev"  class="btn">‹ Prev</button>
      <div id="ab-page-nav"></div>
      <button id="ab-page-next"  class="btn">Next ›</button>
      <button id="ab-page-last"  class="btn">Last »</button>

      <span id="ab-page-info" class="pagination-info"></span>
    </div>

    <div id="meta"><small>
      Generated at: {{GENERATED_AT}} ·
      <a href="{{CSV_LINK}}" download>Download CSV</a>{{DRIVE_LINK_BLOCK}}
    </small></div>
  </div>

  <table id="ab-table">
    <thead><tr>
      <th data-key="cover_href">Cover</th>
      <th data-key="title">Title</th>
      <th data-key="series">Series</th>
      <th data-key="series_index_display" data-type="num">#</th>
      <th data-key="author">Author</th>
      <th data-key="narrator">Narrator</th>
      <th data-key="year">Year</th>
      <th data-key="genre">Genre</th>
      <th data-key="duration_hhmm">Duration (hh:mm)</th>
    </tr></thead>
    <tbody>{{TABLE_ROWS}}</tbody>
  </table>

  <div id="ab-cards">{{CARDS}}</div>

  <div id="ab-empty">No results for “<span id="ab-empty-q"></span>”. Try a different search.</div>
</div>

<!-- Modal -->
<div id="modal" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <button class="close" id="modal-close" aria-label="Close">Close ✕</button>
    <div>
      <img class="cover-lg" id="modal-cover" alt="">
    </div>
    <div>
      <div id="modal-title" class="title"></div>

      <!-- Action buttons -->
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin:2px 0 6px;">
        <a id="m-author-folder" class="link-btn" href="#" target="_blank" rel="noopener" style="display:none">Open author folder</a>
        <a id="m-author-drive" class="link-btn" href="#" target="_blank" rel="noopener" style="display:none">Search author in Drive</a>
        <a id="m-book-drive"   class="link-btn" href="#" target="_blank" rel="noopener" style="display:none">Search book in Drive</a>
      </div>

      <div class="meta-grid" style="margin-top:6px">
        <div class="label">Series</div><div id="m-series"></div>
        <div class="label">#</div><div id="m-index"></div>
        <div class="label">Author</div><div id="m-author"></div>
        <div class="label">Narrator</div><div id="m-narrator"></div>
        <div class="label">Year</div><div id="m-year"></div>
        <div class="label">Genre</div><div id="m-genre"></div>
        <div class="label">Duration</div><div id="m-duration"></div>
      </div>
      <div class="desc" id="m-desc"></div>
    </div>
  </div>
</div>

<script>
/* ===== Theme bootstrap (default Dark ON) ===== */
(function(){
  var saved = localStorage.getItem("ab_theme");
  var startDark = (saved ? saved === "dark" : true);
  if (startDark) document.body.classList.add("dark");
  if (window.matchMedia("(max-width: 820px)").matches){ document.body.classList.add("cards"); }
  var tg = document.getElementById("ab-dark-toggle");
  if (tg) tg.checked = document.body.classList.contains("dark");
})();

/* ===== App logic ===== */
(function(){
  /* Dark toggle */
  var darkToggle = document.getElementById("ab-dark-toggle");
  if (darkToggle){
    darkToggle.addEventListener("change", function(){
      if (darkToggle.checked){ document.body.classList.add("dark");  localStorage.setItem("ab_theme","dark"); }
      else { document.body.classList.remove("dark"); localStorage.setItem("ab_theme","light"); }
    });
  }

  /* Utils */
  function _debounce(fn, ms){ var t; return function(){ clearTimeout(t); var a=arguments,c=this; t=setTimeout(function(){ fn.apply(c,a); }, ms); }; }
  function _normalize(s){ return (s||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/\s+/g," ").trim(); }
  function _tokens(q){ return _normalize(q).split(" ").filter(Boolean); }

  /* Hash helpers */
  function _parseHash(){ var h=(location.hash||"").replace(/^#/,""); var sp=new URLSearchParams(h); var q=sp.get("q")||""; var p=parseInt(sp.get("p")||"1",10); if(isNaN(p)||p<1)p=1; return {q:q,p:p}; }
  function _writeHash(q,p){ var sp=new URLSearchParams(); if(q&&q.trim()) sp.set("q",q); if(p&&p>1) sp.set("p",String(p)); var nh="#"+sp.toString(); if(location.hash!==nh) history.replaceState(null,"",nh); }

  /* Sorting */
  function getCellVal(row,idx,numeric){ var cell=row.children[idx]; if(!cell) return ""; if(numeric){ var key=cell.getAttribute("data-sort"); if(key!==null&&key!==""){ var n=parseFloat(key); if(!isNaN(n)) return n; } var txt=cell.innerText||cell.textContent||""; var n2=parseFloat(txt); return isNaN(n2)?-Infinity:n2; } return cell.innerText||cell.textContent||""; }
  function cmp(a,b,numeric){ return numeric?(a-b):(""+a).localeCompare(""+b,undefined,{numeric:true,sensitivity:"base"}); }
  function sortTableBy(table,idx,numeric,asc){ var tbody=table.tBodies[0]; var rows=Array.from(tbody.querySelectorAll("tr")); rows.sort(function(r1,r2){ var v1=getCellVal(r1,idx,numeric),v2=getCellVal(r2,idx,numeric); return asc?cmp(v1,v2,numeric):cmp(v2,v1,numeric); }); rows.forEach(function(r){ tbody.appendChild(r); }); currentPage=1; renderPage(); }
  function makeTableSortable(table){ var ths=table.querySelectorAll("th"); ths.forEach(function(th,idx){ var asc=true; if(th.getAttribute("data-key")==="cover_href") return; th.style.cursor="pointer"; th.addEventListener("click",function(){ var numeric=th.dataset.type==="num"; sortTableBy(table,idx,numeric,asc); asc=!asc; }); }); }
  function getCardSortKey(card,key,numeric){ var v=card.getAttribute("data-"+key)||""; return numeric?(isNaN(parseFloat(v))?-Infinity:parseFloat(v)):v; }
  function sortCards(container,key,numeric,asc){ var cards=Array.from(container.querySelectorAll(".ab-card")); cards.sort(function(a,b){ var v1=getCardSortKey(a,key,numeric),v2=getCardSortKey(b,key,numeric); return asc?(numeric?(v1-v2):(""+v1).localeCompare(""+v2,undefined,{numeric:true,sensitivity:"base"})):(numeric?(v2-v1):(""+v2).localeCompare(""+v1,undefined,{numeric:true,sensitivity:"base"})); }); cards.forEach(function(c){ container.appendChild(c); }); currentPage=1; renderPage(); }

  /* Pagination */
  var pageSizeEl, pageNav, pageInfo, table, cardsWrap, emptyEl, emptyQEl;
  var currentPage=1;
  function pageSize(){ var v=pageSizeEl?pageSizeEl.value:"100"; if(v==="All") return Infinity; var n=parseInt(v,10); return isNaN(n)?100:n; }
  function renderPage(){
    var ps=pageSize();
    var rows=Array.from(document.querySelectorAll("#ab-table tbody tr"));
    var cards=Array.from(document.querySelectorAll("#ab-cards .ab-card"));

    rows.forEach(function(r){ var m=(r.dataset.searchMatch||"1")==="1"; r.style.display=m?"":"none"; });
    cards.forEach(function(c){ var m=(c.dataset.searchMatch||"1")==="1"; c.style.display=m?"":"none"; });

    rows=rows.filter(function(r){ return (r.dataset.searchMatch||"1")==="1"; });
    cards=cards.filter(function(c){ return (c.dataset.searchMatch||"1")==="1"; });

    var totalRows=rows.length;
    var pagesRows=Math.max(1,Math.ceil(totalRows/ps));
    if(currentPage>pagesRows) currentPage=pagesRows;

    rows.forEach(function(r,i){ var s=(currentPage-1)*ps,e=s+ps; r.style.display=(ps===Infinity||(i>=s&&i<e))?"":"none"; });

    var pagesCards=Math.max(1,Math.ceil(cards.length/ps));
    var pages=Math.max(pagesRows,pagesCards);
    cards.forEach(function(c,i){ var s=(currentPage-1)*ps,e=s+ps; c.style.display=(ps===Infinity||(i>=s&&i<e))?"":"none"; });

    var qVal=(document.getElementById("ab-search")&&document.getElementById("ab-search").value)||"";
    if(emptyEl){
      emptyEl.style.display = (totalRows===0 && qVal.trim()) ? "block" : "none";
      if (totalRows===0 && qVal.trim()) { emptyQEl.textContent=qVal; }
    }
    drawPager(pages,totalRows);
    _writeHash(qVal,currentPage);
  }
  function drawPager(pages,total){
    if(!pageNav) return;
    pageNav.innerHTML="";
    function pill(label,handler,active){ var b=document.createElement("button"); b.className="page-btn"+(active?" active":""); b.textContent=label; b.addEventListener("click",handler); pageNav.appendChild(b); }
    document.getElementById("ab-page-first").onclick=function(){ currentPage=1; renderPage(); }
    document.getElementById("ab-page-prev").onclick =function(){ currentPage=Math.max(1,currentPage-1); renderPage(); }
    document.getElementById("ab-page-next").onclick =function(){ currentPage=Math.min(pages,currentPage+1); renderPage(); }
    document.getElementById("ab-page-last").onclick =function(){ currentPage=pages; renderPage(); }

    var windowSize=2, start=Math.max(1,currentPage-windowSize), end=Math.min(pages,currentPage+windowSize);
    if(start>1){ pill(1,function(){ currentPage=1; renderPage(); }, currentPage===1); if(start>2) pageNav.append("…"); }
    for(var i=start;i<=end;i++){ (function(i0){ pill(i0,function(){ currentPage=i0; renderPage(); }, i0===currentPage); })(i); }
    if(end<pages){ if(end<pages-1) pageNav.append("…"); pill(pages,function(){ currentPage=pages; renderPage(); }, currentPage===pages); }

    var ps=pageSize();
    if(pageInfo){
      if(total===0){ pageInfo.textContent="No results"; }
      else if(ps===Infinity){ pageInfo.textContent="Showing all "+total+" items"; }
      else{ var sIdx=(currentPage-1)*ps+1, eIdx=Math.min(total,currentPage*ps); pageInfo.textContent="Showing "+sIdx+"–"+eIdx+" of "+total; }
    }
  }

  /* Search cache */
  function _buildSearchCache(){
    document.querySelectorAll("#ab-table tbody tr").forEach(function(r){
      if(!r.dataset._searchText){
        var parts=[];
        Array.from(r.cells).forEach(function(td){
          parts.push(td.innerText||td.textContent||"");
          var ds=td.getAttribute("data-sort"); if(ds) parts.push(ds);
        });
        r.dataset._searchText=_normalize(parts.join(" "));
        if(!("searchMatch" in r.dataset)) r.dataset.searchMatch="1";
      }
    });
    document.querySelectorAll("#ab-cards .ab-card").forEach(function(c){
      if(!c.dataset._searchText){
        var keys=["title","series","series_index_sort","author","narrator","year","genre","duration_hhmm"];
        var parts=keys.map(function(k){ return c.getAttribute("data-"+k)||""; });
        parts.push(c.innerText||c.textContent||"");
        c.dataset._searchText=_normalize(parts.join(" "));
        if(!("searchMatch" in c.dataset)) c.dataset.searchMatch="1";
      }
    });
  }
  function _applySearch(q){
    var toks=_tokens(q);
    var matchesAll=function(h){ return toks.every(function(t){ return h.indexOf(t)!==-1; }); };
    document.querySelectorAll("#ab-table tbody tr").forEach(function(r){
      var hay=r.dataset._searchText||""; r.dataset.searchMatch=(!toks.length||matchesAll(hay))?"1":"0";
    });
    document.querySelectorAll("#ab-cards .ab-card").forEach(function(c){
      var hay=c.dataset._searchText||""; c.dataset.searchMatch=(!toks.length||matchesAll(hay))?"1":"0";
    });
  }

  /* Author → Drive map from inline JSON */
  var AUTHOR_MAP={};
  function _loadAuthorMapInline(){
    try{
      var el=document.getElementById("ab-author-map-json");
      if(!el) return;
      var txt=(el.textContent||"").trim();
      if(!txt) return;
      var parsed=JSON.parse(txt);
      if(parsed && typeof parsed==="object"){ AUTHOR_MAP=parsed; }
    }catch(e){ /* ignore parse errors */ }
  }
  function _resolveAuthorFolder(author){
    if(!author) return null;
    if(AUTHOR_MAP[author]) return AUTHOR_MAP[author];
    var aNorm=author.toLowerCase().trim();
    for(var k in AUTHOR_MAP){
      if(!Object.prototype.hasOwnProperty.call(AUTHOR_MAP,k)) continue;
      if(k.toLowerCase().trim()===aNorm) return AUTHOR_MAP[k];
    }
    return null;
  }
  function _authorFolderHref(author){
    var id=_resolveAuthorFolder(author);
    return (id && String(id).trim())
      ? ("https://drive.google.com/drive/folders/"+encodeURIComponent(String(id).trim()))
      : null;
  }
  function _authorSearchHref(author){
    return author && author.trim()
      ? ("https://drive.google.com/drive/search?q="+encodeURIComponent(author.trim()))
      : null;
  }
  function _bookSearchHref(title){
    var clean=(title||"").toString().trim();
    if(clean.startsWith('"') && clean.endsWith('"')) clean=clean.slice(1,-1).trim();
    return clean ? ("https://drive.google.com/drive/search?q="+encodeURIComponent(clean)) : null;
  }

  /* Modal logic */
  var modal=document.getElementById("modal");
  var modalCover=document.getElementById("modal-cover");
  var modalTitle=document.getElementById("modal-title");
  var mSeries=document.getElementById("m-series");
  var mIndex=document.getElementById("m-index");
  var mAuthor=document.getElementById("m-author");
  var mNarrator=document.getElementById("m-narrator");
  var mYear=document.getElementById("m-year");
  var mGenre=document.getElementById("m-genre");
  var mDuration=document.getElementById("m-duration");
  var mDesc=document.getElementById("m-desc");

  var mAuthorDrive=document.getElementById("m-author-drive");
  var mAuthorFolder=document.getElementById("m-author-folder");
  var mBookDrive=document.getElementById("m-book-drive");
  var modalClose=document.getElementById("modal-close");

  function openModal(payload){
    modalCover.src=payload.cover||"";
    modalCover.alt=payload.title||"";
    modalTitle.textContent=payload.title||"";
    mSeries.textContent=payload.series||"";
    mIndex.textContent=payload.index||"";
    mAuthor.textContent=payload.author||"";
    mNarrator.textContent=payload.narrator||"";
    mYear.textContent=payload.year||"";
    mGenre.textContent=payload.genre||"";
    mDuration.textContent=payload.duration||"";
    mDesc.textContent=payload.desc ? payload.desc : "No description available.";

    var author=payload.author||"";
    var folderHref=_authorFolderHref(author);
    var authorSearchHref=_authorSearchHref(author);
    var bookHref=_bookSearchHref(payload.title||"");

    if(folderHref){
      mAuthorFolder.href=folderHref;
      mAuthorFolder.style.display="inline-block";
    } else {
      mAuthorFolder.removeAttribute("href");
      mAuthorFolder.style.display="none";
    }

    if(authorSearchHref){
      mAuthorDrive.href=authorSearchHref;
      mAuthorDrive.style.display="inline-block";
    } else {
      mAuthorDrive.removeAttribute("href");
      mAuthorDrive.style.display="none";
    }

    if(bookHref){
      mBookDrive.href=bookHref;
      mBookDrive.style.display="inline-block";
    } else {
      mBookDrive.removeAttribute("href");
      mBookDrive.style.display="none";
    }

    modal.classList.add("open");
    modal.setAttribute("aria-hidden","false");
  }
  function closeModal(){ modal.classList.remove("open"); modal.setAttribute("aria-hidden","true"); }

  // Cover button -> open
  document.addEventListener("click", function(e){
    var btn=e.target.closest("button.cover-btn");
    if(btn){
      var d=btn.dataset;
      openModal({
        cover:d.cover||"", title:d.title||"", series:d.series||"", index:d.index||"",
        author:d.author||"", narrator:d.narrator||"", year:d.year||"",
        genre:d.genre||"", duration:d.duration||"", desc:d.desc||""
      });
    }
  });

  // Any cell / row click -> open (unless clicking an interactive element)
  document.addEventListener("click", function(e){
    var td=e.target.closest("#ab-table tbody td");
    if(!td) return;
    if (e.target.closest("a,button") && !e.target.closest("button.cover-btn")) return;
    var tr=td.parentElement; if(!tr) return;
    var coverBtn=tr.querySelector("button.cover-btn"); if(!coverBtn) return;
    var d=coverBtn.dataset;
    openModal({
      cover:d.cover||"", title:d.title||"", series:d.series||"", index:d.index||"",
      author:d.author||"", narrator:d.narrator||"", year:d.year||"",
      genre:d.genre||"", duration:d.duration||"", desc:d.desc||""
    });
  });

  if(modalClose) modalClose.addEventListener("click", closeModal);
  modal.addEventListener("click", function(e){ if(e.target===modal) closeModal(); });
  document.addEventListener("keydown", function(e){ if(e.key==="Escape") closeModal(); });

  document.addEventListener("DOMContentLoaded", function(){
    _loadAuthorMapInline();

    table=document.getElementById("ab-table");
    cardsWrap=document.getElementById("ab-cards");
    pageSizeEl=document.getElementById("ab-page-size");
    pageNav=document.getElementById("ab-page-nav");
    pageInfo=document.getElementById("ab-page-info");
    emptyEl=document.getElementById("ab-empty");
    emptyQEl=document.getElementById("ab-empty-q");

    if(table) makeTableSortable(table);

    document.querySelectorAll("#ab-table tbody tr").forEach(function(r){ r.dataset.searchMatch="1"; });
    document.querySelectorAll("#ab-cards .ab-card").forEach(function(c){ c.dataset.searchMatch="1"; });
    _buildSearchCache();

    var search=document.getElementById("ab-search");
    if(search) search.addEventListener("input", _debounce(function(){ _applySearch(search.value); currentPage=1; renderPage(); }, 120));

    var sortSelect=document.getElementById("ab-sort");
    var sortAscBtn=document.getElementById("ab-sort-asc");
    var sortDescBtn=document.getElementById("ab-sort-desc");
    function doSort(asc){
      var parts=sortSelect.value.split("|");
      var key=parts[0], numeric=(parts[1]==="num");
      var idx=Array.from(document.querySelectorAll("#ab-table thead th")).findIndex(function(th){ return th.getAttribute("data-key")===key; });
      if(idx>=0){ sortTableBy(table, idx, numeric, asc); }
      var cards=Array.from(cardsWrap.querySelectorAll(".ab-card"));
      cards.sort(function(a,b){
        var v1=a.getAttribute("data-"+key)||"", v2=b.getAttribute("data-"+key)||"";
        if(numeric){ v1=parseFloat(v1); v2=parseFloat(v2); if(isNaN(v1)) v1=-Infinity; if(isNaN(v2)) v2=-Infinity; }
        return asc ? ((numeric ? (v1-v2) : (""+v1).localeCompare(""+v2,undefined,{numeric:true,sensitivity:"base"})))
                   : ((numeric ? (v2-v1) : (""+v2).localeCompare(""+v1,undefined,{numeric:true,sensitivity:"base"})));
      });
      cards.forEach(function(c){ cardsWrap.appendChild(c); });
      currentPage=1; renderPage();
    }
    if(sortAscBtn) sortAscBtn.addEventListener("click", function(){ doSort(true); });
    if(sortDescBtn)sortDescBtn.addEventListener("click", function(){ doSort(false); });

    var toggle=document.getElementById("ab-toggle-view");
    if(toggle){ toggle.addEventListener("click", function(){ document.body.classList.toggle("cards"); currentPage=1; renderPage(); }); }

    if(pageSizeEl){ pageSizeEl.addEventListener("change", function(){ currentPage=1; renderPage(); }); }

    var hashState=_parseHash();
    if(search && hashState.q){ search.value=hashState.q; _applySearch(hashState.q); }
    if(hashState.p>1){ currentPage=hashState.p; }
    if(!hashState.q){ _applySearch((search||{}).value||""); }
    renderPage();

    window.addEventListener("hashchange", function(){
      var s2=_parseHash();
      var curQ=(search&&search.value)||"";
      if(search && s2.q!==curQ){ search.value=s2.q||""; _applySearch(search.value); }
      currentPage=s2.p||1; renderPage();
    });
  });
})();
</script>
</body>
</html>
